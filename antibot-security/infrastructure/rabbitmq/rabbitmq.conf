# RabbitMQ Configuration for High-Availability Anti-Bot System

# Clustering
cluster_formation.peer_discovery_backend = classic_config
cluster_formation.classic_config.nodes.1 = rabbitmq-1@rabbitmq-1
cluster_formation.classic_config.nodes.2 = rabbitmq-2@rabbitmq-2

# Memory and disk management
vm_memory_high_watermark.relative = 0.6
vm_memory_high_watermark_paging_ratio = 0.5
disk_free_limit.relative = 2.0

# Connection and channel limits
connection_max = 1000
channel_max = 2000

# Network configuration  
tcp_listen_options.backlog = 128
tcp_listen_options.nodelay = true
tcp_listen_options.linger.on = true
tcp_listen_options.linger.timeout = 0
tcp_listen_options.sndbuf = 32768
tcp_listen_options.recbuf = 32768

# Heartbeat configuration
heartbeat = 60

# Message TTL and queue limits
default_vhost = antibot_vhost
default_user = antibot
default_pass = antibotmq

# Queue defaults
queue_master_locator = min-masters

# High availability
ha_promote_on_shutdown = when_synced
ha_promote_on_failure = when_synced

# Logging
log.console = true
log.console.level = info
log.file = false

# Management plugin
management.tcp.port = 15672
management.cors.allow_origins.1 = *
management.load_definitions = /etc/rabbitmq/definitions.json

# Shovel plugin for data replication
shovel.prefetch_count = 1000

# Performance tuning
collect_statistics_interval = 5000
raft.segment_max_entries = 32768

# TLS/SSL (uncomment for production)
# ssl_options.cacertfile = /etc/ssl/certs/ca-certificate.pem
# ssl_options.certfile   = /etc/ssl/certs/server-certificate.pem
# ssl_options.keyfile    = /etc/ssl/private/server-key.pem
# ssl_options.verify     = verify_peer
# ssl_options.fail_if_no_peer_cert = false